/* Optimized Feeds Loader | IIFE ES7 Minified */
(()=>{"use strict";const CACHE_DUR=3e5,LAZY_MARGIN="200px",skelHtml=()=>{const t=`<li style="display:flex;gap:12px;margin-bottom:15px;align-items:center;"><div class="sk-img" style="aspect-ratio:16/9;width:-webkit-fill-available;height:auto;max-height:150px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:sk-load 1.5s infinite;border-radius:4px;"></div><div style="flex:1;"><div style="height:14px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:sk-load 1.5s infinite;border-radius:3px;width:80%;margin-bottom:8px;"></div><div style="height:10px;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:sk-load 1.5s infinite;border-radius:3px;width:40%;"></div></div></li>`,n=innerWidth>=768?4:2;return`<style>@keyframes sk-load{0%{background-position:200% 0}100%{background-position:-200% 0}}</style><ul style="list-style:none;padding:0;margin:0;">${Array(n).fill(t).join("")}</ul>`},renderList=t=>{if(!t.length)return"<p>Tidak ada konten.</p>";return`<ul style="list-style:none;padding:0;margin:0;">${t.map(({link:t,title:e,img:i,date:a})=>`<li style="display:flex;gap:12px;margin-bottom:15px;align-items:center;"><a href="${t}" aria-label="${e}" class="post-img"><img src="${i}" style="width:70px;height:50px;object-fit:cover;border-radius:4px;" onerror="this.src='https://placehold.co/70x50'"/></a><div style="flex:1;"><h2 class="h3 jl_fe_title jl_txt_2row" style="font-size:18px;display:block;line-height:1.5;"><a href="${t}" target="_blank">${e}</a></h2><small style="font-size:11px;">${a}</small></div></li>`).join("")}</ul>`},getCached=t=>{try{const e=localStorage.getItem(t);if(!e)return null;const i=JSON.parse(e);return Date.now()-i.timestamp>CACHE_DUR?(localStorage.removeItem(t),null):i.value}catch{return null}},setCache=(t,e)=>{try{localStorage.setItem(t,JSON.stringify({value:e,timestamp:Date.now()}))}catch{}},addPreconnect=t=>{t.forEach(t=>{if(!document.querySelector(`link[href*="${t}"]`)){const e=document.createElement("link");e.rel="preconnect",e.href=`https://${t}`,e.crossOrigin="anonymous",document.head.appendChild(e)}})},fetchWPOptimized=async(t,e,i)=>{const a=`wp_${t}_${e||"all"}_${i}`,n=getCached(a);if(n)return n;let s=`https://${t}/wp-json/wp/v2/posts?per_page=${i}&_fields=id,title,link,date,featured_media`;e&&(s+=`&categories=${e}`);const o=new AbortController,c=setTimeout(()=>o.abort(),8e3);try{const e=await fetch(s,{signal:o.signal,mode:"cors",cache:"force-cache"});clearTimeout(c);if(!e.ok)throw new Error("HTTP error");const i=await e.json(),r=[...new Set(i.filter(t=>t.featured_media).map(t=>t.featured_media))];let l={};if(r.length)try{const t=await(await fetch(`https://${t}/wp-json/wp/v2/media?include=${r.join(",")}&_fields=id,source_url`,{cache:"force-cache"})).json();t.forEach(t=>{l[t.id]=t.source_url})}catch{}const d=i.map(t=>({title:t.title.rendered||t.title,link:t.link,rawDate:t.date,date:new Date(t.date).toLocaleDateString("id-ID"),source:t,img:l[t.featured_media]||"https://placehold.co/70x50"}));return setCache(a,d),d}catch(t){return clearTimeout(c),console.warn(`WP fetch failed:`,t.message),[]}},fetchWPCategory=async(t,e)=>{const i=`wp_cat_${t}_${e}`,a=getCached(i);if(a)return a;try{const i=await(await fetch(`https://${t}/wp-json/wp/v2/categories?search=${encodeURIComponent(e)}&per_page=5&_fields=id,slug,name`,{cache:"force-cache"})).json();if(!i.length)return null;const a=i.find(t=>t.slug===e.toLowerCase()),n=i.find(t=>t.name.toLowerCase()===e.toLowerCase()),s=(a||n||i[0]).id;return setCache(i,s),s}catch{return null}},loadBloggerOptimized=(t,e,i,a)=>{const n=`blg_${t}_${e||"all"}_${i}`,s=getCached(n);if(s)return void a(s);const o="blgCb_"+Math.random().toString(36).slice(2);window[o]=t=>{document.getElementById(o)?.remove(),delete window[o];const e=(t.feed.entry||[]).map(t=>({title:t.title.$t,link:t.link.find(t=>"alternate"===t.rel).href,rawDate:t.published.$t,date:new Date(t.published.$t).toLocaleDateString("id-ID"),img:t.media$thumbnail?t.media$thumbnail.url.replace(/\/s\d+-c\//,"/s320-c/"):"https://placehold.co/70x50"}));setCache(n,e),a(e)};const c=document.createElement("script");c.id=o,c.src=`https://${t}/feeds/posts/default${e?`/-/${encodeURIComponent(e)}/`:"/"} ?alt=json&max-results=${i}&callback=${o}`,c.onerror=()=>{document.getElementById(o)?.remove(),delete window[o],a([])},document.body.appendChild(c)},observer=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=t.target,i=e.dataset.loader;e.innerHTML=skelHtml(),i&&window[i]&&(window[i](e),delete e.dataset.loader),observer.unobserve(e)}})},{rootMargin:LAZY_MARGIN});window.loadSingleWP=async t=>{const e=t.getAttribute("data-source"),i=parseInt(t.getAttribute("data-items"))||5,a=await fetchWPOptimized(e,null,i);t.innerHTML=renderList(a)};window.loadSingleBlogger=t=>{const e=t.getAttribute("data-source"),i=parseInt(t.getAttribute("data-items"))||5;loadBloggerOptimized(e,null,i,e=>t.innerHTML=renderList(e))};window.loadMultiWP=async t=>{const e=t.getAttribute("data-sources").split(",").map(t=>t.trim()).filter(Boolean),i=t.getAttribute("data-category")||"",a=parseInt(t.getAttribute("data-items"))||10,n=t.getAttribute("data-sort")||"date";if(!e.length)return;addPreconnect(e);const s=await Promise.allSettled(e.map(async t=>{const e=i?await fetchWPCategory(t,i):null;return e===null&&i?[]:fetchWPOptimized(t,e,a)}));let o=[];s.forEach(t=>{"fulfilled"===t.status&&(o=o.concat(t.value))});"date"===n&&o.sort((t,e)=>new Date(e.rawDate)-new Date(t.rawDate)),t.innerHTML=renderList(o.slice(0,a))};window.loadMultiBlogger=t=>{const e=t.getAttribute("data-sources").split(",").map(t=>t.trim()).filter(Boolean),i=t.getAttribute("data-category")||"",a=parseInt(t.getAttribute("data-items"))||10,n=t.getAttribute("data-sort")||"date";if(!e.length)return;addPreconnect(e);let s=[],o=0;e.forEach(t=>{loadBloggerOptimized(t,i,a,t=>{s=s.concat(t),++o===e.length&&("date"===n&&s.sort((t,e)=>new Date(e.rawDate)-new Date(t.rawDate)),document.querySelector(".recent-blg-multi").innerHTML=renderList(s.slice(0,a)))})})};document.addEventListener("DOMContentLoaded",()=>{[".recent-wp","loadSingleWP"],[".recent-blg","loadSingleBlogger"],[".recent-wp-multi","loadMultiWP"],[".recent-blg-multi","loadMultiBlogger"]].forEach(([t,e])=>{document.querySelectorAll(t).forEach(t=>{t.dataset.loader=e,observer.observe(t)})})});})();

/* scroll up/down class toggle */
(t=>{let e,i=pageYOffset||document.documentElement.scrollTop;addEventListener("scroll",()=>{const a=pageYOffset||document.documentElement.scrollTop;Math.abs(a-i)>t&&(a>i?!1!==e&&(document.body.classList.replace("up","dw"),e=!1):!0!==e&&(document.body.classList.replace("dw","up"),e=!0),i=a),0===a&&document.body.classList.remove("up")})})(70);
